@using AlriyadahBMS.Shared.ViewModels
@inherits LayoutComponentBase
@inject LocalizationService Language

@* <div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div> *@

<MudRTLProvider RightToLeft="@LocalizationService.IsRTL">
    <MudDialogProvider />
    <MudSnackbarProvider />
    <MudThemeProvider Theme="MyCustomTheme" />

    <CascadingValue Value="this">
        <MudLayout>
            <ChildContent>
                <AuthorizeView>
                    <Authorized>
                        <MudAppBar Elevation="1">
                            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
                            <MudSpacer />
                            <MudIconButton Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit" Edge="Edge.End" />
                        </MudAppBar>
                        <MudDrawer @bind-Open="_drawerOpen" Elevation="2">

                            <MudDrawerHeader>
                                <MudText Typo="Typo.h5" Class="mt-1">AlriyadahBMS</MudText>
                            </MudDrawerHeader>

                            <MudDrawerContainer>
                                <MudNavMenu Class="mud-width-full">
                                    <MudNavLink Href="/tblStudentlist" Match="NavLinkMatch.All" Style="font-size: 16px">
                                        <MudIcon Icon="@Icons.Material.Filled.Dashboard" /> Status check
                                    </MudNavLink>

                                    <MudNavLink Href="/tblStudentlist" Match="NavLinkMatch.All" Style="font-size: 16px">
                                        <MudIcon Icon="@Icons.Material.Filled.AppRegistration" /> Student Registration
                                    </MudNavLink>

                                    <MudNavLink Href="/paymentsInfo" Match="NavLinkMatch.All" Style="font-size: 16px">
                                        <MudIcon Icon="@Icons.Material.Filled.Payment" /> Payments
                                    </MudNavLink>

                                    <MudNavLink Variant="Variant.Text" Style="font-size: 16px" OnClick="OpenDrawer">
                                        <MudIcon Icon="@Icons.Material.Filled.Language" /> Language
                                    </MudNavLink>

                                    <MudNavLink Href="/logout" Match="NavLinkMatch.All" Style="font-size: 16px">
                                        <MudIcon Icon="@Icons.Material.Filled.Logout" />
                                        Logout
                                    </MudNavLink>
                                </MudNavMenu>
                            </MudDrawerContainer>
                        </MudDrawer>

                        <MudDrawer Class="mud-theme-primary rounded-t-xl" @bind-Open="@open" Anchor="Anchor.Bottom" Variant="@DrawerVariant.Temporary"  >
                            <MudDrawerHeader>
                                <MudText Typo="Typo.h6">App Language</MudText>
                            </MudDrawerHeader>
                            <MudDrawerContainer>

                                <MudPaper Class="pa-3">
                                    @if (LocalizationService.SelectedLanguage != null)
                                    {
                                        <MudRadioGroup T="EwLanguage" Value="LocalizationService.SelectedLanguage" ValueChanged="LanguageSelectedOptionChanged">
                                            <MudStack Spacing="0">

                                                @foreach (var language in LocalizationService.EwLanguages)
                                                {
                                                    <MudRadio Value="language">
                                                        @language.Name
                                                    </MudRadio>
                                                }
                                            </MudStack>
                                        </MudRadioGroup>
                                    }
                                </MudPaper>
                            </MudDrawerContainer>
                        </MudDrawer>
                    </Authorized>
                </AuthorizeView>
                @Body
            </ChildContent>
        </MudLayout>
    </CascadingValue>
</MudRTLProvider>



@code {

    bool open = false;

    void OpenDrawer()
    {
        open = !open;
        
    }

    protected override void OnInitialized()
    {
        StateHasChanged();
    }

    public async Task LanguageSelectedOptionChanged(EwLanguage language)
    {
        // LocalizationService.SelectedLanguage = language;

        // if (LocalizationService.SelectedLanguage.Id == "ar-SA")
        // {
        //     LocalizationService.IsRTL = true;
        // }
        // else
        // {
        //     LocalizationService.IsRTL = false;
        // }

        await LocalizationService.SetLanguageAsync(language);
        open = false;
        StateHasChanged();

    }
}